<?xml version="1.0" encoding="UTF-8"?>


<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="reply">
	
	<!-- 게시판 댓글 삽입 -->
	<insert id="insertReply">
		INSERT INTO tb_reply (
		reply_no,
		board_no ,
		reply_login ,
		reply_id ,
		reply_pw ,
		reply_content,
		reply_grp,
		reply_class
		) VALUES (
		(select max(o.reply_no)+1 as num from tb_reply o),
		#{boardNo},
		#{replyLogin},
		 #{replyId},
		 #{replyPw},
		 #{replyContent},
		 (select max(o.reply_grp)+1 from tb_reply o),
		 #{replyClass}
		)
	</insert>
	
	<!-- 게시판 대댓글 삽입 -->
	<insert id="insertReplyTo">
		INSERT INTO tb_reply (
		reply_no,
		board_no ,
		reply_login ,
		reply_id ,
		reply_pw ,
		reply_content,
		reply_grp,
		reply_class
		) VALUES (
		(select max(o.reply_no)+1 as num from tb_reply o),
		#{boardNo},
		#{replyLogin},
		 #{replyId},
		 #{replyPw},
		 #{replyContent},
		 #{replyGrp},
		 #{replyClass}
		)
	</insert>

	<!-- 게시판 회원 댓글 수정 -->
	<update id="updateReply">
		UPDATE tb_reply
		SET
		reply_content = #{replyContent} ,
		reply_udt_dt = NOW()
		WHERE 
		reply_no = #{replyNo}
		AND
		reply_del_flag = 'Y' 
	</update>
	
	<!-- 게시판 댓글 삭제 -->
	<delete id="deleteReply">
		UPDATE tb_reply
		SET
		reply_del_flag = 'N'
		WHERE 
		reply_no = #{replyNo}
	</delete>
	
	<!-- 게시판 비회원 댓글 수정 -->
	<update id="updateReplyNon">
		UPDATE tb_reply
		SET
		reply_content = #{replyContent} ,
		reply_udt_dt = NOW()
		WHERE 
		reply_no = #{replyNo}
		AND
		reply_del_flag = 'Y' 
		AND
		reply_id = #{replyId}
		AND
		reply_pw = #{replyPw}
	</update>

	<!-- 게시판 비회원 댓글 삭제 -->
	<delete id="deleteReplyNon">
		UPDATE tb_reply
		SET
		reply_del_flag = 'N'
		WHERE 
		reply_no = #{replyNo}
		AND
		reply_id = #{replyId}
		AND
		reply_pw = #{replyPw}
	</delete>

	<!-- 게시판 리스트 가져오기 -->
	<select id="listPaging" resultMap="ReplyResultMap">
		SELECT
		reply_no
		, board_no
		, reply_login
		, reply_id
		, reply_pw
		, reply_content
		, reply_grp
		, reply_class
		, reply_del_flag
		, reply_reg_dt
		, reply_udt_dt
		, reply_del_dt
		FROM
		tb_reply
		WHERE board_no = #{boardNo}		
		ORDER BY reply_grp 
		LIMIT #{criteria.pageStart}, #{criteria.perPageNum}
	</select>

	<!-- 게시판 리스트 카운트 -->
	<select id="countReplies" resultType="int">
		SELECT
		COUNT(board_no)
		FROM
		tb_reply
		WHERE board_no = #{boardNo}		
	</select>


	<resultMap id="ReplyResultMap" type="ReplyVo">
		<id property="replyNo" column="reply_no" />
		<result property="boardNo" column="board_no" />
		<result property="replyLogin" column="reply_login" />
		<result property="replyId" column="reply_id" />
		<result property="replyPw" column="reply_pw" />
		<result property="replyContent" column="reply_content" />
		<result property="replyGrp" column="reply_grp" />
		<result property="replyClass" column="reply_class" />
		<result property="replyDelFlag" column="reply_del_flag" />
		<result property="replyRegDate" column="reply_reg_dt" />
		<result property="replyUdtDate" column="reply_udt_dt" />
		<result property="replyDelDate" column="reply_del_dt" />
	</resultMap>

</mapper>